<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="/static/index.css" />
        <title>TT</title>
    </head>
    <body>
        <h2>List of books</h2>
        <iframe src="/test" style="width:100%;height:400px"></iframe>
        <input id="ff" value="" placeholder="token" style="width:100%;height:64px"></input>
        <button onclick="ditme()">Open and send token</button>
        <script defer>
            function ditme() {
                const t = document.getElementById("ff");
                const v = t.value;
                let x
                console.log("CON CAC")
                
                x = window.open("/test?cac=1");
                setTimeout(() => {
                    x.postMessage({
                        type: "message",
                        p_type: "hello"
                    }, "*")
                }, 2000);
                window.addEventListener("message", (event) => {
                    console.log(">>> SEND MESSAGE", event.origin);
                    const { data } = event;
                    if (event.data === "sendToMe") {
                        x.postMessage({
                            type: "message",
                            p_type: "token",
                            token: v
                        }, '*')
                    }
                })
            }
        </script>
    </body>
</html>